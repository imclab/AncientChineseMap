<!DOCTYPE html>
<html>
    <head>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta http-equiv="Cache-control" content="public">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <link rel="stylesheet" type="text/css" href="css/style.css" />
		<title>Ancient Chinese Map</title>

        <script type="text/javascript" src="js/libs/pxloader/PxLoader.js"></script>
        <script type="text/javascript" src="js/libs/pxloader/PxLoaderImage.js"></script>
        <script type="text/javascript" src="js/libs/easeljs-0.4.1.min.js"></script> 
        <script type="text/javascript" src="js/libs/tweenjs-0.2.0.min.js"></script> 
        <script type="text/javascript" src="js/libs/Stats.js"></script> 
        <script type="text/javascript" src="js/libs/webgl-utils.js"></script> 
        <script type="text/javascript" src="js/libs/glMatrix-0.9.5.min.js"></script> 
        <script type="text/javascript" src="js/libs/webgl-debug.js"></script> 
        <script type="text/javascript" src="js/bongiovi/SimpleCamera.js"></script> 
        <script type="text/javascript" src="js/bongiovi/HoverCamera.js"></script> 
        <script type="text/javascript" src="js/bongiovi/ProjectionPerspectiveMatrix.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLModelShader.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLModel.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLTexture.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLTextureFilter.js"></script> 
        <script type="text/javascript" src="js/Index.js"></script>


        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            attribute vec2 aTextureCoord;
            attribute vec2 sizeOffset;

            uniform mat4 uMVMatrix;
            uniform mat4 uPMatrix;
            uniform mat3 invertCamera;

            varying vec2 vTextureCoord;
            varying vec3 vVertexCoord;
            varying vec3 vOutputCoord;

            void main(void) {
                vec3 size = vec3(sizeOffset, 0.0);
                vec3 adjustSize = size * invertCamera;
                vec3 pos = aVertexPosition + adjustSize;
                vec4 finalPos = uPMatrix * uMVMatrix * vec4(pos, 1.0);
                gl_Position = finalPos;
                vTextureCoord = aTextureCoord;
                vVertexCoord = finalPos.xyz;
            }
        </script>

        <script id="shader-fs" type="x-shader/x-fragment">
            precision mediump float;

            varying vec2 vTextureCoord;
            varying vec3 vVertexCoord;

            uniform sampler2D uSampler0;
            uniform sampler2D uSampler1;
            uniform float brightness;

            void main(void) {
                vec4 color0 = texture2D(uSampler0, vec2(vTextureCoord.s, vTextureCoord.t));
                vec4 color1 = texture2D(uSampler1, vec2(vTextureCoord.s, vTextureCoord.t));
                color0.rgb *= brightness;
                color1.rgb *= brightness;

                float offset = (vVertexCoord.z / 300.0 + 1.0) * .5;
                offset = abs( 1.0 - offset) * 2.0 -.25;
                offset = clamp(offset, 0.0, 1.0);
                float pi = 3.1415926;
                offset = sin(offset*pi*.5);

                vec4 color = color1 * offset + color0 * ( 1.0 - offset);
                color.a *= (0.0 + (1.0-offset) * 1.0);


                float maxDist = length(vec2(400.0, 400.0));
                float dist = length(vVertexCoord.xy);
                color.a *= 1.0 - dist/maxDist;
                color.rgb *= dist/maxDist;

                gl_FragColor = color;
            }
        </script>

        <script>
            window.requestAnimFrame = (function(){
                return  window.requestAnimationFrame       || 
                window.webkitRequestAnimationFrame || 
                window.mozRequestAnimationFrame    || 
                window.oRequestAnimationFrame      || 
                window.msRequestAnimationFrame     || 
                function( callback ){
                window.setTimeout(callback, 1000 / 60);
                };
            })();


            var main;


            function init() {
                console.log( "INIT" );
                main = new Index();
                main.init();
            }

        </script>
    </head>
    
        

    <body onload="init()">
    </body>
</html>