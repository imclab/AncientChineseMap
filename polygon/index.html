<!DOCTYPE html>
<html>
    <head>
        <title>Polygon World</title>
        <style type="text/css">
          html { height: 100% }
          body { height: 100%; margin: 0px; padding: 0px }
          #map_canvas { height: 100% }
          #status { color: #FF0000; position:fixed; top:15px; left:105px; z-index:200;}
        </style>
		
        <script type="text/javascript" src="js/libs/Stats.js"></script> 
        <script type="text/javascript" src="js/libs/webgl-utils.js"></script> 
        <script type="text/javascript" src="js/libs/glMatrix-0.9.5.min.js"></script> 
        <script type="text/javascript" src="js/libs/webgl-debug.js"></script> 
        <script type="text/javascript" src="js/libs/dat.gui.min.js"></script> 
        <script type="text/javascript" src="js/bongiovi/Scheduler.js"></script> 
        <script type="text/javascript" src="js/bongiovi/SimpleCamera.js"></script> 
        <script type="text/javascript" src="js/bongiovi/HoverCamera.js"></script> 
        <script type="text/javascript" src="js/bongiovi/ProjectionPerspectiveMatrix.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLModelShader.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLModel.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLTexture.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLTextureFilter.js"></script> 
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=false&language=en"></script>
        <script type="text/javascript" src="js/Index.js"></script>


        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            attribute vec3 aVertexNormal;
            attribute vec2 aTextureCoord;

            uniform mat4 uMVMatrix;
            uniform mat4 uPMatrix;
            uniform mat3 uNMatrix;

            uniform vec3 uAmbientColor;

            uniform vec3 uLightingDirection0;
            uniform vec3 uDirectionalColor0;
			uniform float lightWeight0;
			
            uniform vec3 uLightingDirection1;
            uniform vec3 uDirectionalColor1;
			uniform float lightWeight1;
			
            uniform vec3 uLightingDirection2;
            uniform vec3 uDirectionalColor2;
			uniform float lightWeight2;
			
            varying vec2 vTextureCoord;
            varying vec3 vLightWeighting;

            void main(void) {
                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
                vTextureCoord = aTextureCoord;

                vec3 transformedNormal = uNMatrix * aVertexNormal;
				// transformedNormal = normalize(transformedNormal);
				
                float directionalLightWeighting0 = max(dot(aVertexNormal, uLightingDirection0), 0.0);
                vec3 vLightWeighting0 = (uAmbientColor + uDirectionalColor0 * directionalLightWeighting0) * lightWeight0;
				
                float directionalLightWeighting1 = max(dot(aVertexNormal, uLightingDirection1), 0.0);
                vec3 vLightWeighting1 = (uAmbientColor + uDirectionalColor1 * directionalLightWeighting1) * lightWeight1;
				
                float directionalLightWeighting2 = max(dot(aVertexNormal, uLightingDirection2), 0.0);
                vec3 vLightWeighting2 = (uAmbientColor + uDirectionalColor2 * directionalLightWeighting2) * lightWeight2;
				
				vLightWeighting = vLightWeighting0+vLightWeighting1+vLightWeighting2;
            }
        </script>

        <script id="shader-fs" type="x-shader/x-fragment">
            precision mediump float;

            varying vec2 vTextureCoord;
            varying vec3 vLightWeighting;

            uniform sampler2D uSampler0;


            void main(void) {
                vec4 textureColor = texture2D(uSampler0, vec2(vTextureCoord.s, vTextureCoord.t));
                gl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);
            }
        </script>
        


        <script>
			var polygon;
		
            function init(){
                canvasGL = document.createElement("canvas");
                canvasGL.id = "canvasGL";
                canvasGL.width = window.innerWidth/2;
                canvasGL.height = window.innerHeight;
                canvasGL.style.position = "absolute";
                canvasGL.style.zIndex = "0";
                canvasGL.style.left = window.innerWidth/2 + "px";

                gl = canvasGL.getContext("experimental-webgl");
                gl.viewportWidth = window.innerWidth/2;
                gl.viewportHeight = window.innerHeight;
                document.body.appendChild(canvasGL);

                var styles = [
                  {
                    "stylers": [
                      { "saturation": -100 },
                      { "lightness": 1 }
                    ]
                  },{
                    "featureType": "poi",
                    "stylers": [
                      { "visibility": "off" }
                    ]
                  },{
                    "featureType": "administrative",
                    "stylers": [
                      { "visibility": "off" }
                    ]
                  },{
                    "featureType": "landscape",
                    "stylers": [
                      { "visibility": "off" }
                    ]
                  },{
                    "featureType": "road.local",
                    "stylers": [
                      { "visibility": "simplified" }
                    ]
                  },{
                    "featureType": "road.arterial",
                    "stylers": [
                      { "visibility": "simplified" }
                    ]
                  },{
                    "featureType": "transit.station",
                    "stylers": [
                      { "weight": 5.1 }
                    ]
                  },{
                    "featureType": "transit.station",
                    "stylers": [
                      { "gamma": 0.01 }
                    ]
                  },{
                  }
                ]

                var latlng = new google.maps.LatLng(24.209394675097073, 120.673828125);

                var styledMap = new google.maps.StyledMapType(styles,   {name: "Styled Map"});  

                var myOptions = {
                    zoom: 9,   
                    center: latlng,
                    mapTypeControlOptions: {
                        mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
                    }
                };

                map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
                map.mapTypes.set('map_style', styledMap);
                map.setMapTypeId('map_style');
				
                var img = new Image();
                img.onload = function(e) {
                    texture = new GLTexture(gl, img);
					onLoaded();
                }
                img.src = "images/whitebg.jpg";
            }
			
			function onLoaded() {
				scheduler = new Scheduler();
                gui = new dat.GUI();
				polygon = new Index(map, gl).init();
				
                gui.add(polygon, 'size', 50, 100);
				gui.addColor(polygon, 'ambientColor');
				var f1 = gui.addFolder('Light0');
				f1.add(polygon, 'light0X', -1.0, 1.0);
				f1.add(polygon, 'light0Y', -1.0, 1.0);
				f1.add(polygon, 'light0Z', -1.0, 1.0);
				f1.add(polygon, 'lightWeight0', 0.0, 3.0);
				f1.addColor(polygon, 'lightColor0');
				f1.open();
				
				var f2 = gui.addFolder('Light1');
				f2.add(polygon, 'light1X', -1.0, 1.0);
				f2.add(polygon, 'light1Y', -1.0, 1.0);
				f2.add(polygon, 'light1Z', -1.0, 1.0);
				f2.add(polygon, 'lightWeight1', 0.0, 3.0);
				f2.addColor(polygon, 'lightColor1');
				f2.open();
				
				var f3 = gui.addFolder('Light2');
				f3.add(polygon, 'light2X', -1.0, 1.0);
				f3.add(polygon, 'light2Y', -1.0, 1.0);
				f3.add(polygon, 'light2Z', -1.0, 1.0);
				f3.add(polygon, 'lightWeight2', 0.0, 3.0);
				f3.addColor(polygon, 'lightColor2');
				f3.open();
				
                gui.add(polygon, 'reset', 20, 100);

			}
        </script>
    </head>
        

    <body onload="init()">
        <div id="map_canvas" style="width:50%; height:100%; z-index:1; position:absolute;"></div>
    </body>
</html>