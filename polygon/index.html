<!DOCTYPE html>
<html>
    <head>
        <title>Polygon World</title>
        <style type="text/css">
          html { height: 100% }
          body { height: 100%; margin: 0px; padding: 0px }
          #map_canvas { height: 100% }
          #status { color: #FF0000; position:fixed; top:15px; left:105px; z-index:200;}
        </style>
		
        <script type="text/javascript" src="js/libs/Stats.js"></script> 
        <script type="text/javascript" src="js/libs/webgl-utils.js"></script> 
        <script type="text/javascript" src="js/libs/glMatrix-0.9.5.min.js"></script> 
        <script type="text/javascript" src="js/libs/webgl-debug.js"></script> 
        <script type="text/javascript" src="js/libs/dat.gui.min.js"></script> 
        <script type="text/javascript" src="js/bongiovi/Scheduler.js"></script> 
        <script type="text/javascript" src="js/bongiovi/SimpleCamera.js"></script> 
        <script type="text/javascript" src="js/bongiovi/HoverCamera.js"></script> 
        <script type="text/javascript" src="js/bongiovi/ProjectionPerspectiveMatrix.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLModelShader.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLModel.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLTexture.js"></script> 
        <script type="text/javascript" src="js/bongiovi/GLTextureFilter.js"></script> 
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=false&language=en"></script>
        <script type="text/javascript" src="js/Index.js"></script>


        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            attribute vec3 aVertexNormal;
            attribute vec2 aTextureCoord;

            uniform mat4 uMVMatrix;
            uniform mat4 uPMatrix;
            uniform mat3 uNMatrix;

            uniform vec3 uAmbientColor;

            uniform vec3 uLightingDirection;
            uniform vec3 uDirectionalColor;

            varying vec2 vTextureCoord;
            varying vec3 vLightWeighting;

            void main(void) {
                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
                vTextureCoord = aTextureCoord;

                vec3 transformedNormal = uNMatrix * aVertexNormal;
				// transformedNormal = normalize(transformedNormal);
				
                float directionalLightWeighting = max(dot(aVertexNormal, uLightingDirection), 0.0);
                vLightWeighting = uAmbientColor + uDirectionalColor * directionalLightWeighting;
            }
        </script>

        <script id="shader-fs" type="x-shader/x-fragment">
            precision mediump float;

            varying vec2 vTextureCoord;
            varying vec3 vLightWeighting;

            uniform sampler2D uSampler0;


            void main(void) {
                vec4 textureColor = texture2D(uSampler0, vec2(vTextureCoord.s, vTextureCoord.t));
                gl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);
            }
        </script>
        


        <script>
			var polygon;
		
            function init(){
                canvasGL = document.createElement("canvas");
                canvasGL.id = "canvasGL";
                canvasGL.width = window.innerWidth/2;
                canvasGL.height = window.innerHeight;
                canvasGL.style.position = "absolute";
                canvasGL.style.zIndex = "0";
                canvasGL.style.left = window.innerWidth/2 + "px";

                gl = canvasGL.getContext("experimental-webgl");
                gl.viewportWidth = window.innerWidth/2;
                gl.viewportHeight = window.innerHeight;
                document.body.appendChild(canvasGL);

                var styles = [
                  {
                    "stylers": [
                      { "saturation": -100 },
                      { "lightness": 1 }
                    ]
                  },{
                    "featureType": "poi",
                    "stylers": [
                      { "visibility": "off" }
                    ]
                  },{
                    "featureType": "administrative",
                    "stylers": [
                      { "visibility": "off" }
                    ]
                  },{
                    "featureType": "landscape",
                    "stylers": [
                      { "visibility": "off" }
                    ]
                  },{
                    "featureType": "road.local",
                    "stylers": [
                      { "visibility": "simplified" }
                    ]
                  },{
                    "featureType": "road.arterial",
                    "stylers": [
                      { "visibility": "simplified" }
                    ]
                  },{
                    "featureType": "transit.station",
                    "stylers": [
                      { "weight": 5.1 }
                    ]
                  },{
                    "featureType": "transit.station",
                    "stylers": [
                      { "gamma": 0.01 }
                    ]
                  },{
                  }
                ]

                var latlng = new google.maps.LatLng(24.209394675097073, 120.673828125);

                var styledMap = new google.maps.StyledMapType(styles,   {name: "Styled Map"});  

                var myOptions = {
                    zoom: 9,   
                    center: latlng,
                    mapTypeControlOptions: {
                        mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
                    }
                };

                map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
                map.mapTypes.set('map_style', styledMap);
                map.setMapTypeId('map_style');
				
                var img = new Image();
                img.onload = function(e) {
                    texture = new GLTexture(gl, img);
					onLoaded();
                }
                img.src = "images/whitebg.jpg";
            }
			
			function onLoaded() {
				scheduler = new Scheduler();
                gui = new dat.GUI();
				polygon = new Index(map, gl).init();
				
                gui.add(polygon, 'size', 50, 100);
				
				var f1 = gui.addFolder('Light');
				f1.add(polygon, 'lightX', -1.0, 1.0);
				f1.add(polygon, 'lightY', -1.0, 1.0);
				f1.add(polygon, 'lightZ', -1.0, 1.0);
				f1.open();
				
                gui.add(polygon, 'reset', 20, 100);

			}
        </script>
    </head>
        

    <body onload="init()">
        <div id="map_canvas" style="width:50%; height:100%; z-index:1; position:absolute;"></div>
    </body>
</html>